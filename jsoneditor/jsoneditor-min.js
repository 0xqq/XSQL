!function(){function a(b,c,d){if(!(this instanceof a))throw new Error('JSONEditor constructor called without "new".');var e=util.getInternetExplorerVersion();if(-1!=e&&9>e)throw new Error("不支持低于IE9的浏览器");arguments.length&&this._create(b,c,d)}function b(a,c,d){if(!(this instanceof b))throw new Error('TreeEditor constructor called without "new".');this._create(a,c,d)}function c(a,b,d){if(!(this instanceof c))throw new Error('TextEditor constructor called without "new".');this._create(a,b,d)}function d(a,b){this.editor=a,this.dom={},this.expanded=!1,b&&b instanceof Object?(this.setField(b.field,b.fieldEditable),this.setValue(b.value,b.type)):(this.setField(""),this.setValue(null))}function e(a){this.editor=a,this.dom={}}function f(a,b){function c(a,b,e){e.forEach(function(e){var f,g,h,i,j,k,l,m,n,o;"separator"==e.type?(f=document.createElement("div"),f.className="separator",h=document.createElement("li"),h.appendChild(f),a.appendChild(h)):(g={},h=document.createElement("li"),a.appendChild(h),i=document.createElement("button"),i.className=e.className,g.button=i,e.title&&(i.title=e.title),e.click&&(i.onclick=function(){d.hide(),e.click()}),h.appendChild(i),e.submenu?(j=document.createElement("div"),j.className="icon",i.appendChild(j),i.appendChild(document.createTextNode(e.text)),e.click?(i.className+=" default",l=document.createElement("button"),g.buttonExpand=l,l.className="expand",l.innerHTML='<div class="expand"></div>',h.appendChild(l),e.submenuTitle&&(l.title=e.submenuTitle),k=l):(m=document.createElement("div"),m.className="expand",i.appendChild(m),k=i),k.onclick=function(){d._onExpandItem(g),k.focus()},n=[],g.subItems=n,o=document.createElement("ul"),g.ul=o,o.className="menu",o.style.height="0",h.appendChild(o),c(o,n,e.submenu)):i.innerHTML='<div class="icon"></div>'+e.text,b.push(g))})}var d,e,f,g,h,i;this.dom={},d=this,e=this.dom,this.anchor=void 0,this.items=a,this.eventListeners={},this.selection=void 0,this.visibleSubmenu=void 0,this.onClose=b?b.close:void 0,f=document.createElement("div"),f.className="jsoneditor-contextmenu",e.menu=f,g=document.createElement("ul"),g.className="menu",f.appendChild(g),e.list=g,e.items=[],h=document.createElement("button"),e.focusButton=h,i=document.createElement("li"),i.style.overflow="hidden",i.style.height="0",i.appendChild(h),g.appendChild(i),c(g,this.dom.items,a),this.maxHeight=0,a.forEach(function(b){var c=24*(a.length+(b.submenu?b.submenu.length:0));d.maxHeight=Math.max(d.maxHeight,c)})}function g(a){this.editor=a,this.clear(),this.actions={editField:{undo:function(a){a.node.updateField(a.oldValue)},redo:function(a){a.node.updateField(a.newValue)}},editValue:{undo:function(a){a.node.updateValue(a.oldValue)},redo:function(a){a.node.updateValue(a.newValue)}},appendNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.appendChild(a.node)}},insertBeforeNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.insertBefore(a.node,a.beforeNode)}},insertAfterNode:{undo:function(a){a.parent.removeChild(a.node)},redo:function(a){a.parent.insertAfter(a.node,a.afterNode)}},removeNode:{undo:function(a){var b=a.parent,c=b.childs[a.index]||b.append;b.insertBefore(a.node,c)},redo:function(a){a.parent.removeChild(a.node)}},duplicateNode:{undo:function(a){a.parent.removeChild(a.clone)},redo:function(a){a.parent.insertAfter(a.clone,a.node)}},changeType:{undo:function(a){a.node.changeType(a.oldType)},redo:function(a){a.node.changeType(a.newType)}},moveNode:{undo:function(a){a.startParent.moveTo(a.node,a.startIndex)},redo:function(a){a.endParent.moveTo(a.node,a.endIndex)}},sort:{undo:function(a){var b=a.node;b.hideChilds(),b.sort=a.oldSort,b.childs=a.oldChilds,b.showChilds()},redo:function(a){var b=a.node;b.hideChilds(),b.sort=a.newSort,b.childs=a.newChilds,b.showChilds()}}}}function h(a,b,c){function d(b){a.setMode(b);var c=a.dom&&a.dom.modeBox;c&&c.focus()}var e,g,h,i,j,k,l,m;for(e={code:{text:"Code",title:"Switch to code highlighter",click:function(){d("code")}},form:{text:"Form",title:"Switch to form editor",click:function(){d("form")}},text:{text:"Text",title:"Switch to plain text editor",click:function(){d("text")}},tree:{text:"Tree",title:"Switch to tree editor",click:function(){d("tree")}},view:{text:"View",title:"Switch to tree view",click:function(){d("view")}}},g=[],h=0;h<b.length;h++){if(i=b[h],j=e[i],!j)throw new Error('Unknown mode "'+i+'"');j.className="type-modes"+(c==i?" selected":""),g.push(j)}if(k=e[c],!k)throw new Error('Unknown mode "'+c+'"');return l=k.text,m=document.createElement("button"),m.className="modes separator",m.innerHTML=l+" &#x25BE;",m.title="Switch editor mode",m.onclick=function(){var a=new f(g);a.show(m)},m}function i(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=this;this.editor=a,this.timeout=void 0,this.delay=200,this.lastText=void 0,this.dom={},this.dom.container=b,c=document.createElement("table"),this.dom.table=c,c.className="search",b.appendChild(c),d=document.createElement("tbody"),this.dom.tbody=d,c.appendChild(d),e=document.createElement("tr"),d.appendChild(e),f=document.createElement("td"),e.appendChild(f),g=document.createElement("div"),this.dom.results=g,g.className="results",f.appendChild(g),f=document.createElement("td"),e.appendChild(f),h=document.createElement("div"),this.dom.input=h,h.className="frame",h.title="搜索",f.appendChild(h),i=document.createElement("table"),h.appendChild(i),j=document.createElement("tbody"),i.appendChild(j),e=document.createElement("tr"),j.appendChild(e),k=document.createElement("button"),k.className="refresh",f=document.createElement("td"),f.appendChild(k),e.appendChild(f),l=document.createElement("input"),this.dom.search=l,l.oninput=function(a){o._onDelayedSearch(a)},l.onchange=function(a){o._onSearch(a)},l.onkeydown=function(a){o._onKeyDown(a)},l.onkeyup=function(a){o._onKeyUp(a)},k.onclick=function(){l.select()},f=document.createElement("td"),f.appendChild(l),e.appendChild(f),m=document.createElement("button"),m.title="下一个结果 (Enter)",m.className="next",m.onclick=function(){o.next()},f=document.createElement("td"),f.appendChild(m),e.appendChild(f),n=document.createElement("button"),n.title="上一个结果 (Shift+Enter)",n.className="previous",n.onclick=function(){o.previous()},f=document.createElement("td"),f.appendChild(n),e.appendChild(f)}function j(){this.locked=!1}var k,l,m,n;a.modes={},a.prototype._create=function(a,b,c){this.container=a,this.options=b||{},this.json=c||{};var d=this.options.mode||"tree";this.setMode(d)},a.prototype._delete=function(){},a.prototype.set=function(a){this.json=a},a.prototype.get=function(){return this.json},a.prototype.setText=function(a){this.json=util.parse(a)},a.prototype.getText=function(){return JSON.stringify(this.json)},a.prototype.setName=function(a){this.options||(this.options={}),this.options.name=a},a.prototype.getName=function(){return this.options&&this.options.name},a.prototype.setMode=function(b){var c,d,e,f=this.container,g=util.extend({},this.options);if(g.mode=b,e=a.modes[b],!e)throw new Error('Unknown mode "'+g.mode+'"');try{if("text"==e.data?(d=this.getName(),c=this.getText(),this._delete(),util.clear(this),util.extend(this,e.editor.prototype),this._create(f,g),this.setName(d),this.setText(c)):(d=this.getName(),c=this.get(),this._delete(),util.clear(this),util.extend(this,e.editor.prototype),this._create(f,g),this.setName(d),this.set(c)),"function"==typeof e.load)try{e.load.call(this)}catch(h){}}catch(h){this._onError(h)}},a.prototype._onError=function(a){if("function"==typeof this.onError&&(util.log("WARNING: JSONEditor.onError is deprecated. Use options.error instead."),this.onError(a)),!this.options||"function"!=typeof this.options.error)throw a;this.options.error(a)},b.prototype._create=function(a,b,c){if(!a)throw new Error("No container element provided.");this.container=a,this.dom={},this.highlighter=new j,this.selection=void 0,this._setOptions(b),this.options.history&&!this.mode.view&&(this.history=new g(this)),this._createFrame(),this._createTable(),this.set(c||{})},b.prototype._delete=function(){this.frame&&this.container&&this.frame.parentNode==this.container&&this.container.removeChild(this.frame)},b.prototype._setOptions=function(a){if(this.options={search:!0,history:!0,mode:"tree",name:void 0},a){for(var b in a)a.hasOwnProperty(b)&&(this.options[b]=a[b]);a.enableSearch&&(this.options.search=a.enableSearch,util.log('WARNING: Option "enableSearch" is deprecated. Use "search" instead.')),a.enableHistory&&(this.options.history=a.enableHistory,util.log('WARNING: Option "enableHistory" is deprecated. Use "history" instead.')),"editor"==a.mode&&(this.options.mode="tree",util.log('WARNING: Mode "editor" is deprecated. Use "tree" instead.')),"viewer"==a.mode&&(this.options.mode="view",util.log('WARNING: Mode "viewer" is deprecated. Use "view" instead.'))}this.mode={edit:"view"!=this.options.mode&&"form"!=this.options.mode,view:"view"==this.options.mode,form:"form"==this.options.mode}},b.focusNode=void 0,b.prototype.set=function(a,b){var c,e,f;b&&(util.log('Warning: second parameter "name" is deprecated. Use setName(name) instead.'),this.options.name=b),a instanceof Function||void 0===a?this.clear():(this.content.removeChild(this.table),c={field:this.options.name,value:a},e=new d(this,c),this._setRoot(e),f=!1,this.node.expand(f),this.content.appendChild(this.table)),this.history&&this.history.clear()},b.prototype.get=function(){return b.focusNode&&b.focusNode.blur(),this.node?this.node.getValue():void 0},b.prototype.getText=function(){return JSON.stringify(this.get())},b.prototype.setText=function(a){this.set(util.parse(a))},b.prototype.setName=function(a){this.options.name=a,this.node&&this.node.updateField(this.options.name)},b.prototype.getName=function(){return this.options.name},b.prototype.clear=function(){this.node&&(this.node.collapse(),this.tbody.removeChild(this.node.getDom()),delete this.node)},b.prototype._setRoot=function(a){this.clear(),this.node=a,this.tbody.appendChild(a.getDom())},b.prototype.search=function(a){var b;return this.node?(this.content.removeChild(this.table),b=this.node.search(a),this.content.appendChild(this.table)):b=[],b},b.prototype.expandAll=function(){this.node&&(this.content.removeChild(this.table),this.node.expand(),this.content.appendChild(this.table))},b.prototype.collapseAll=function(){this.node&&(this.content.removeChild(this.table),this.node.collapse(),this.content.appendChild(this.table))},b.prototype._onAction=function(a,b){if(this.history&&this.history.add(a,b),this.options.change)try{this.options.change()}catch(c){util.log("Error in change callback: ",c)}},b.prototype.startAutoScroll=function(a){var b=this,c=this.content,d=util.getAbsoluteTop(c),e=c.clientHeight,f=d+e,g=24,h=50;this.autoScrollStep=d+g>a&&c.scrollTop>0?(d+g-a)/3:a>f-g&&e+c.scrollTop<c.scrollHeight?(f-g-a)/3:void 0,this.autoScrollStep?this.autoScrollTimer||(this.autoScrollTimer=setInterval(function(){b.autoScrollStep?c.scrollTop-=b.autoScrollStep:b.stopAutoScroll()},h)):this.stopAutoScroll()},b.prototype.stopAutoScroll=function(){this.autoScrollTimer&&(clearTimeout(this.autoScrollTimer),delete this.autoScrollTimer),this.autoScrollStep&&delete this.autoScrollStep},b.prototype.setSelection=function(a){a&&("scrollTop"in a&&this.content&&(this.content.scrollTop=a.scrollTop),a.range&&util.setSelectionOffset(a.range),a.dom&&a.dom.focus())},b.prototype.getSelection=function(){return{dom:b.domFocus,scrollTop:this.content?this.content.scrollTop:0,range:util.getSelectionOffset()}},b.prototype.scrollTo=function(a,b){var c,d,e,f,g,h=this.content;h?(c=this,c.animateTimeout&&(clearTimeout(c.animateTimeout),delete c.animateTimeout),c.animateCallback&&(c.animateCallback(!1),delete c.animateCallback),d=h.clientHeight,e=h.scrollHeight-d,f=Math.min(Math.max(a-d/4,0),e),g=function(){var a=h.scrollTop,d=f-a;Math.abs(d)>3?(h.scrollTop+=d/3,c.animateCallback=b,c.animateTimeout=setTimeout(g,50)):(b&&b(!0),h.scrollTop=f,delete c.animateTimeout,delete c.animateCallback)},g()):b&&b(!1)},b.prototype._createFrame=function(){var a,b,c,d,e,f,g;this.frame=document.createElement("div"),this.frame.className="jsoneditor",this.container.appendChild(this.frame),a=this,b=function(b){a._onEvent(b)},this.frame.onclick=function(a){var c=a.target;b(a),"BUTTON"==c.nodeName&&a.preventDefault()},this.frame.oninput=b,this.frame.onchange=b,this.frame.onkeydown=b,this.frame.onkeyup=b,this.frame.oncut=b,this.frame.onpaste=b,this.frame.onmousedown=b,this.frame.onmouseup=b,this.frame.onmouseover=b,this.frame.onmouseout=b,util.addEventListener(this.frame,"focus",b,!0),util.addEventListener(this.frame,"blur",b,!0),this.frame.onfocusin=b,this.frame.onfocusout=b,this.menu=document.createElement("div"),this.menu.className="menu",this.frame.appendChild(this.menu),c=document.createElement("button"),c.className="expand-all",c.title="展开节点",c.onclick=function(){a.expandAll()},this.menu.appendChild(c),d=document.createElement("button"),d.title="折叠节点",d.className="collapse-all",d.onclick=function(){a.collapseAll()},this.menu.appendChild(d),this.history&&(e=document.createElement("button"),e.className="undo separator",e.title="后退 Ctrl+Z",e.onclick=function(){a._onUndo()},this.menu.appendChild(e),this.dom.undo=e,f=document.createElement("button"),f.className="redo",f.title="前进 (Ctrl+Shift+Z)",f.onclick=function(){a._onRedo()},this.menu.appendChild(f),this.dom.redo=f,this.history.onChange=function(){e.disabled=!a.history.canUndo(),f.disabled=!a.history.canRedo()},this.history.onChange()),this.options&&this.options.modes&&this.options.modes.length&&(g=h(this,this.options.modes,this.options.mode),this.menu.appendChild(g),this.dom.modeBox=g),this.options.search&&(this.searchBox=new i(this,this.menu))},b.prototype._onUndo=function(){this.history&&(this.history.undo(),this.options.change&&this.options.change())},b.prototype._onRedo=function(){this.history&&(this.history.redo(),this.options.change&&this.options.change())},b.prototype._onEvent=function(a){var c,e=a.target;"keydown"==a.type&&this._onKeyDown(a),"focus"==a.type&&(b.domFocus=e),c=d.getNodeFromTarget(e),c&&c.onEvent(a)},b.prototype._onKeyDown=function(a){var c,d=a.which||a.keyCode,e=a.ctrlKey,f=a.shiftKey,g=!1;9==d&&setTimeout(function(){util.selectContentEditable(b.domFocus)},0),this.searchBox&&(e&&70==d?(this.searchBox.dom.search.focus(),this.searchBox.dom.search.select(),g=!0):(114==d||e&&71==d)&&(c=!0,f?this.searchBox.previous(c):this.searchBox.next(c),g=!0)),this.history&&(e&&!f&&90==d?(this._onUndo(),g=!0):e&&f&&90==d&&(this._onRedo(),g=!0)),g&&(a.preventDefault(),a.stopPropagation())},b.prototype._createTable=function(){var a,b=document.createElement("div");b.className="outer",this.contentOuter=b,this.content=document.createElement("div"),this.content.className="tree",b.appendChild(this.content),this.table=document.createElement("table"),this.table.className="tree",this.content.appendChild(this.table),this.colgroupContent=document.createElement("colgroup"),this.mode.edit&&(a=document.createElement("col"),a.width="24px",this.colgroupContent.appendChild(a)),a=document.createElement("col"),a.width="24px",this.colgroupContent.appendChild(a),a=document.createElement("col"),this.colgroupContent.appendChild(a),this.table.appendChild(this.colgroupContent),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.frame.appendChild(b)},a.modes.tree={editor:b,data:"json"},a.modes.view={editor:b,data:"json"},a.modes.form={editor:b,data:"json"},a.modes.editor={editor:b,data:"json"},a.modes.viewer={editor:b,data:"json"},c.prototype._create=function(a,b,c){var d,e,f,g,i,j;b=b||{},this.options=b,this.indentation=b.indentation?Number(b.indentation):2,this.mode="code"==b.mode?"code":"text","code"==this.mode&&"undefined"==typeof ace&&(this.mode="text",util.log("WARNING: Cannot load code editor, Ace library not loaded. Falling back to plain text editor")),d=this,this.container=a,this.dom={},this.editor=void 0,this.textarea=void 0,this.width=a.clientWidth,this.height=a.clientHeight,this.frame=document.createElement("div"),this.frame.className="jsoneditor",this.frame.onclick=function(a){a.preventDefault()},this.menu=document.createElement("div"),this.menu.className="menu",this.frame.appendChild(this.menu),e=document.createElement("button"),e.className="format",e.title="换行缩进显示",this.menu.appendChild(e),e.onclick=function(){try{d.format()}catch(a){d._onError(a)}},f=document.createElement("button"),f.className="compact",f.title="不换行显示",this.menu.appendChild(f),f.onclick=function(){try{d.compact()}catch(a){d._onError(a)}},this.options&&this.options.modes&&this.options.modes.length&&(g=h(this,this.options.modes,this.options.mode),this.menu.appendChild(g),this.dom.modeBox=g),this.content=document.createElement("div"),this.content.className="outer",this.frame.appendChild(this.content),this.container.appendChild(this.frame),"code"==this.mode?(this.editorDom=document.createElement("div"),this.editorDom.style.height="100%",this.editorDom.style.width="100%",this.content.appendChild(this.editorDom),i=ace.edit(this.editorDom),i.setTheme("ace/theme/jsoneditor"),i.setShowPrintMargin(!1),i.setFontSize(13),i.getSession().setMode("ace/mode/json"),i.getSession().setUseSoftTabs(!0),i.getSession().setUseWrapMode(!0),this.editor=i,b.change&&i.on("change",function(){b.change()})):(j=document.createElement("textarea"),j.className="text",j.spellcheck=!1,this.content.appendChild(j),this.textarea=j,b.change&&(null===this.textarea.oninput?this.textarea.oninput=function(){b.change()}:this.textarea.onchange=function(){b.change()})),"string"==typeof c?this.setText(c):this.set(c)},c.prototype._delete=function(){this.frame&&this.container&&this.frame.parentNode==this.container&&this.container.removeChild(this.frame)},c.prototype._onError=function(a){if("function"==typeof this.onError&&(util.log("WARNING: JSONEditor.onError is deprecated. Use options.error instead."),this.onError(a)),!this.options||"function"!=typeof this.options.error)throw a;this.options.error(a)},c.prototype.compact=function(){var a=util.parse(this.getText());this.setText(JSON.stringify(a))},c.prototype.format=function(){var a=util.parse(this.getText());this.setText(JSON.stringify(a,null,this.indentation))},c.prototype.focus=function(){this.textarea&&this.textarea.focus(),this.editor&&this.editor.focus()},c.prototype.resize=function(){if(this.editor){var a=!1;this.editor.resize(a)}},c.prototype.set=function(a){this.setText(JSON.stringify(a,null,this.indentation))},c.prototype.get=function(){return util.parse(this.getText())},c.prototype.getText=function(){return this.textarea?this.textarea.value:this.editor?this.editor.getValue():""},c.prototype.setText=function(a){this.textarea&&(this.textarea.value=a),this.editor&&this.editor.setValue(a,-1)},a.modes.text={editor:c,data:"text",load:c.prototype.format},a.modes.code={editor:c,data:"text",load:c.prototype.format},d.prototype.setParent=function(a){this.parent=a},d.prototype.setField=function(a,b){this.field=a,this.fieldEditable=1==b},d.prototype.getField=function(){return void 0===this.field&&this._getDomField(),this.field},d.prototype.setValue=function(a,b){var c,e,f,g,h,i=this.childs;if(i)for(;i.length;)this.removeChild(i[0]);if(this.type=this._getType(a),b&&b!=this.type){if("string"!=b||"auto"!=this.type)throw new Error('Type mismatch: cannot cast value of type "'+this.type+' to the specified type "'+b+'"');this.type=b}if("array"==this.type){for(this.childs=[],f=0,g=a.length;g>f;f++)c=a[f],void 0===c||c instanceof Function||(e=new d(this.editor,{value:c}),this.appendChild(e));this.value=""}else if("object"==this.type){this.childs=[];for(h in a)a.hasOwnProperty(h)&&(c=a[h],void 0===c||c instanceof Function||(e=new d(this.editor,{field:h,value:c}),this.appendChild(e)));this.value=""}else this.childs=void 0,this.value=a},d.prototype.getValue=function(){var a,b;return"array"==this.type?(a=[],this.childs.forEach(function(b){a.push(b.getValue())}),a):"object"==this.type?(b={},this.childs.forEach(function(a){b[a.getField()]=a.getValue()}),b):(void 0===this.value&&this._getDomValue(),this.value)},d.prototype.getLevel=function(){return this.parent?this.parent.getLevel()+1:0},d.prototype.clone=function(){var a,b=new d(this.editor);return b.type=this.type,b.field=this.field,b.fieldInnerText=this.fieldInnerText,b.fieldEditable=this.fieldEditable,b.value=this.value,b.valueInnerText=this.valueInnerText,b.expanded=this.expanded,this.childs?(a=[],this.childs.forEach(function(c){var d=c.clone();d.setParent(b),a.push(d)}),b.childs=a):b.childs=void 0,b},d.prototype.expand=function(a){this.childs&&(this.expanded=!0,this.dom.expand&&(this.dom.expand.className="expanded"),this.showChilds(),0!=a&&this.childs.forEach(function(b){b.expand(a)}))},d.prototype.collapse=function(a){this.childs&&(this.hideChilds(),0!=a&&this.childs.forEach(function(b){b.collapse(a)}),this.dom.expand&&(this.dom.expand.className="collapsed"),this.expanded=!1)},d.prototype.showChilds=function(){var a,b,c,d,e=this.childs;e&&this.expanded&&(a=this.dom.tr,b=a?a.parentNode:void 0,b&&(c=this.getAppend(),d=a.nextSibling,d?b.insertBefore(c,d):b.appendChild(c),this.childs.forEach(function(a){b.insertBefore(a.getDom(),c),a.showChilds()})))},d.prototype.hide=function(){var a=this.dom.tr,b=a?a.parentNode:void 0;b&&b.removeChild(a),this.hideChilds()},d.prototype.hideChilds=function(){var a,b=this.childs;b&&this.expanded&&(a=this.getAppend(),a.parentNode&&a.parentNode.removeChild(a),this.childs.forEach(function(a){a.hide()}))},d.prototype.appendChild=function(a){if(this._hasChilds()){if(a.setParent(this),a.fieldEditable="object"==this.type,"array"==this.type&&(a.index=this.childs.length),this.childs.push(a),this.expanded){var b=a.getDom(),c=this.getAppend(),d=c?c.parentNode:void 0;c&&d&&d.insertBefore(b,c),a.showChilds()}this.updateDom({updateIndexes:!0}),a.updateDom({recurse:!0})}},d.prototype.moveBefore=function(a,b){var c,d;this._hasChilds()&&(c=this.dom.tr?this.dom.tr.parentNode:void 0,c&&(d=document.createElement("tr"),d.style.height=c.clientHeight+"px",c.appendChild(d)),a.parent&&a.parent.removeChild(a),b instanceof e?this.appendChild(a):this.insertBefore(a,b),c&&c.removeChild(d))},d.prototype.moveTo=function(a,b){var c,d;a.parent==this&&(c=this.childs.indexOf(a),b>c&&b++),d=this.childs[b]||this.append,this.moveBefore(a,d)},d.prototype.insertBefore=function(a,b){var c,d,e,f;if(this._hasChilds()){if(b==this.append)a.setParent(this),a.fieldEditable="object"==this.type,this.childs.push(a);else{if(c=this.childs.indexOf(b),-1==c)throw new Error("Node not found");a.setParent(this),a.fieldEditable="object"==this.type,this.childs.splice(c,0,a)}this.expanded&&(d=a.getDom(),e=b.getDom(),f=e?e.parentNode:void 0,e&&f&&f.insertBefore(d,e),a.showChilds()),this.updateDom({updateIndexes:!0}),a.updateDom({recurse:!0})}},d.prototype.insertAfter=function(a,b){if(this._hasChilds()){var c=this.childs.indexOf(b),d=this.childs[c+1];d?this.insertBefore(a,d):this.appendChild(a)}},d.prototype.search=function(a){var b,c,d,e,f,g=[],h=a?a.toLowerCase():void 0;return delete this.searchField,delete this.searchValue,void 0!=this.field&&(c=String(this.field).toLowerCase(),b=c.indexOf(h),-1!=b&&(this.searchField=!0,g.push({node:this,elem:"field"})),this._updateDomField()),this._hasChilds()?(this.childs&&(d=[],this.childs.forEach(function(b){d=d.concat(b.search(a))}),g=g.concat(d)),void 0!=h&&(e=!1,0==d.length?this.collapse(e):this.expand(e))):(void 0!=this.value&&(f=String(this.value).toLowerCase(),b=f.indexOf(h),-1!=b&&(this.searchValue=!0,g.push({node:this,elem:"value"}))),this._updateDomValue()),g},d.prototype.scrollTo=function(a){if(!this.dom.tr||!this.dom.tr.parentNode)for(var b=this.parent,c=!1;b;)b.expand(c),b=b.parent;this.dom.tr&&this.dom.tr.parentNode&&this.editor.scrollTo(this.dom.tr.offsetTop,a)},d.focusElement=void 0,d.prototype.focus=function(a){if(d.focusElement=a,this.dom.tr&&this.dom.tr.parentNode){var b=this.dom;switch(a){case"drag":b.drag?b.drag.focus():b.menu.focus();break;case"menu":b.menu.focus();break;case"expand":this._hasChilds()?b.expand.focus():b.field&&this.fieldEditable?(b.field.focus(),util.selectContentEditable(b.field)):b.value&&!this._hasChilds()?(b.value.focus(),util.selectContentEditable(b.value)):b.menu.focus();break;case"field":b.field&&this.fieldEditable?(b.field.focus(),util.selectContentEditable(b.field)):b.value&&!this._hasChilds()?(b.value.focus(),util.selectContentEditable(b.value)):this._hasChilds()?b.expand.focus():b.menu.focus();break;case"value":default:b.value&&!this._hasChilds()?(b.value.focus(),util.selectContentEditable(b.value)):b.field&&this.fieldEditable?(b.field.focus(),util.selectContentEditable(b.field)):this._hasChilds()?b.expand.focus():b.menu.focus()}}},d.select=function(a){setTimeout(function(){util.selectContentEditable(a)},0)},d.prototype.blur=function(){this._getDomValue(!1),this._getDomField(!1)},d.prototype._duplicate=function(a){var b=a.clone();return this.insertAfter(b,a),b},d.prototype.containsNode=function(a){var b,c,d;if(this==a)return!0;if(b=this.childs)for(c=0,d=b.length;d>c;c++)if(b[c].containsNode(a))return!0;return!1},d.prototype._move=function(a,b){if(a!=b){if(a.containsNode(this))throw new Error("Cannot move a field into a child of itself");a.parent&&a.parent.removeChild(a);var c=a.clone();a.clearDom(),b?this.insertBefore(c,b):this.appendChild(c)}},d.prototype.removeChild=function(a){var b,c;return this.childs&&(b=this.childs.indexOf(a),-1!=b)?(a.hide(),delete a.searchField,delete a.searchValue,c=this.childs.splice(b,1)[0],this.updateDom({updateIndexes:!0}),c):void 0},d.prototype._remove=function(a){this.removeChild(a)},d.prototype.changeType=function(a){var b,c,d,e=this.type;e!=a&&("string"!=a&&"auto"!=a||"string"!=e&&"auto"!=e?(c=this.dom.tr?this.dom.tr.parentNode:void 0,b=this.expanded?this.getAppend():this.getDom(),d=b&&b.parentNode?b.nextSibling:void 0,this.hide(),this.clearDom(),this.type=a,"object"==a?(this.childs||(this.childs=[]),this.childs.forEach(function(a){a.clearDom(),delete a.index,a.fieldEditable=!0,void 0==a.field&&(a.field="")}),("string"==e||"auto"==e)&&(this.expanded=!0)):"array"==a?(this.childs||(this.childs=[]),this.childs.forEach(function(a,b){a.clearDom(),a.fieldEditable=!1,a.index=b}),("string"==e||"auto"==e)&&(this.expanded=!0)):this.expanded=!1,c&&(d?c.insertBefore(this.getDom(),d):c.appendChild(this.getDom())),this.showChilds()):this.type=a,("auto"==a||"string"==a)&&(this.value="string"==a?String(this.value):this._stringCast(String(this.value)),this.focus()),this.updateDom({updateIndexes:!0}))},d.prototype._getDomValue=function(a){var b,c,d;if(this.dom.value&&"array"!=this.type&&"object"!=this.type&&(this.valueInnerText=util.getInnerText(this.dom.value)),void 0!=this.valueInnerText)try{"string"==this.type?b=this._unescapeHTML(this.valueInnerText):(c=this._unescapeHTML(this.valueInnerText),b=this._stringCast(c)),b!==this.value&&(d=this.value,this.value=b,this.editor._onAction("editValue",{node:this,oldValue:d,newValue:b,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()}))}catch(e){if(this.value=void 0,1!=a)throw e}},d.prototype._updateDomValue=function(){var a,b,c,d,e,f,g=this.dom.value;g&&(a=this.value,b="auto"==this.type?util.type(a):this.type,c="string"==b&&util.isUrl(a),d="",d=c&&!this.editor.mode.edit?"":"string"==b?"green":"number"==b?"red":"boolean"==b?"darkorange":this._hasChilds()?"":null===a?"#004ED0":"black",g.style.color=d,e=""==String(this.value)&&"array"!=this.type&&"object"!=this.type,e?util.addClassName(g,"empty"):util.removeClassName(g,"empty"),c?util.addClassName(g,"url"):util.removeClassName(g,"url"),"array"==b||"object"==b?(f=this.childs?this.childs.length:0,g.title=this.type+" containing "+f+" items"):"string"==b&&util.isUrl(a)?this.editor.mode.edit&&(g.title="Ctrl+Enter 或 Ctrl+点击 打开链接"):g.title="",this.searchValueActive?util.addClassName(g,"highlight-active"):util.removeClassName(g,"highlight-active"),this.searchValue?util.addClassName(g,"highlight"):util.removeClassName(g,"highlight"),util.stripFormatting(g))},d.prototype._updateDomField=function(){var a,b=this.dom.field;b&&(a=""==String(this.field)&&"array"!=this.parent.type,a?util.addClassName(b,"empty"):util.removeClassName(b,"empty"),this.searchFieldActive?util.addClassName(b,"highlight-active"):util.removeClassName(b,"highlight-active"),this.searchField?util.addClassName(b,"highlight"):util.removeClassName(b,"highlight"),util.stripFormatting(b))},d.prototype._getDomField=function(a){var b,c;if(this.dom.field&&this.fieldEditable&&(this.fieldInnerText=util.getInnerText(this.dom.field)),void 0!=this.fieldInnerText)try{b=this._unescapeHTML(this.fieldInnerText),b!==this.field&&(c=this.field,this.field=b,this.editor._onAction("editField",{node:this,oldValue:c,newValue:b,oldSelection:this.editor.selection,newSelection:this.editor.getSelection()}))}catch(d){if(this.field=void 0,1!=a)throw d}},d.prototype.clearDom=function(){this.dom={}},d.prototype.getDom=function(){var a,b,c,d,e,f=this.dom;return f.tr?f.tr:(f.tr=document.createElement("tr"),f.tr.node=this,this.editor.mode.edit&&(a=document.createElement("td"),this.parent&&(b=document.createElement("button"),f.drag=b,b.className="dragarea",b.title="拖动对象顺序 (Alt+Shift+↑/↓)",a.appendChild(b)),f.tr.appendChild(a),c=document.createElement("td"),d=document.createElement("button"),f.menu=d,d.className="contextmenu",d.title="点击打开操作菜单 (Ctrl+M)",c.appendChild(f.menu),f.tr.appendChild(c)),e=document.createElement("td"),f.tr.appendChild(e),f.tree=this._createDomTree(),e.appendChild(f.tree),this.updateDom({updateIndexes:!0}),f.tr)},d.prototype._onDragStart=function(a){var b=this;this.mousemove||(this.mousemove=util.addEventListener(document,"mousemove",function(a){b._onDrag(a)})),this.mouseup||(this.mouseup=util.addEventListener(document,"mouseup",function(a){b._onDragEnd(a)})),this.editor.highlighter.lock(),this.drag={oldCursor:document.body.style.cursor,startParent:this.parent,startIndex:this.parent.childs.indexOf(this),mouseX:a.pageX,level:this.getLevel()},document.body.style.cursor="move",a.preventDefault()},d.prototype._onDrag=function(a){var b,c,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=a.pageY,x=a.pageX,y=!1;if(b=this.dom.tr,l=util.getAbsoluteTop(b),o=b.offsetHeight,l>w){c=b;do c=c.previousSibling,j=d.getNodeFromTarget(c),m=c?util.getAbsoluteTop(c):0;while(c&&m>w);j&&!j.parent&&(j=void 0),j||(i=b.parentNode.firstChild,c=i?i.nextSibling:void 0,j=d.getNodeFromTarget(c),j==this&&(j=void 0)),j&&(c=j.dom.tr,m=c?util.getAbsoluteTop(c):0,w>m+o&&(j=void 0)),j&&(j.parent.moveBefore(this,j),y=!0)}else if(h=this.expanded&&this.append?this.append.getDom():this.dom.tr,g=h?h.nextSibling:void 0){n=util.getAbsoluteTop(g),f=g;do k=d.getNodeFromTarget(f),f&&(p=f.nextSibling?util.getAbsoluteTop(f.nextSibling):0,q=f?p-n:0,1==k.parent.childs.length&&k.parent.childs[0]==this&&(l+=23)),f=f.nextSibling;while(f&&w>l+q);if(k&&k.parent){for(r=x-this.drag.mouseX,s=Math.round(r/24/2),t=this.drag.level+s,u=k.getLevel(),c=k.dom.tr.previousSibling;t>u&&c;){if(j=d.getNodeFromTarget(c),j==this||j._isChildOf(this));else{if(!(j instanceof e))break;if(v=j.parent.childs,!(v.length>1||1==v.length&&v[0]!=this))break;k=d.getNodeFromTarget(c),u=k.getLevel()}c=c.previousSibling}h.nextSibling!=k.dom.tr&&(k.parent.moveBefore(this,k),y=!0)}}y&&(this.drag.mouseX=x,this.drag.level=this.getLevel()),this.editor.startAutoScroll(w),a.preventDefault()},d.prototype._onDragEnd=function(a){var b={node:this,startParent:this.drag.startParent,startIndex:this.drag.startIndex,endParent:this.parent,endIndex:this.parent.childs.indexOf(this)};(b.startParent!=b.endParent||b.startIndex!=b.endIndex)&&this.editor._onAction("moveNode",b),document.body.style.cursor=this.drag.oldCursor,this.editor.highlighter.unlock(),delete this.drag,this.mousemove&&(util.removeEventListener(document,"mousemove",this.mousemove),delete this.mousemove),this.mouseup&&(util.removeEventListener(document,"mouseup",this.mouseup),delete this.mouseup),this.editor.stopAutoScroll(),a.preventDefault()},d.prototype._isChildOf=function(a){for(var b=this.parent;b;){if(b==a)return!0;
b=b.parent}return!1},d.prototype._createDomField=function(){return document.createElement("div")},d.prototype.setHighlight=function(a){this.dom.tr&&(this.dom.tr.className=a?"highlight":"",this.append&&this.append.setHighlight(a),this.childs&&this.childs.forEach(function(b){b.setHighlight(a)}))},d.prototype.updateValue=function(a){this.value=a,this.updateDom()},d.prototype.updateField=function(a){this.field=a,this.updateDom()},d.prototype.updateDom=function(a){var b,c,d,e,f=this.dom.tree;f&&(f.style.marginLeft=24*this.getLevel()+"px"),b=this.dom.field,b&&(1==this.fieldEditable?(b.contentEditable=this.editor.mode.edit,b.spellcheck=!1,b.className="field"):b.className="readonly",c=void 0!=this.index?this.index:void 0!=this.field?this.field:this._hasChilds()?this.type:"",b.innerHTML=this._escapeHTML(c)),d=this.dom.value,d&&(e=this.childs?this.childs.length:0,d.innerHTML="array"==this.type?"["+e+"]":"object"==this.type?"{"+e+"}":this._escapeHTML(this.value)),this._updateDomField(),this._updateDomValue(),a&&1==a.updateIndexes&&this._updateDomIndexes(),a&&1==a.recurse&&this.childs&&this.childs.forEach(function(b){b.updateDom(a)}),this.append&&this.append.updateDom()},d.prototype._updateDomIndexes=function(){var a=this.dom.value,b=this.childs;a&&b&&("array"==this.type?b.forEach(function(a,b){a.index=b;var c=a.dom.field;c&&(c.innerHTML=b)}):"object"==this.type&&b.forEach(function(a){void 0!=a.index&&(delete a.index,void 0==a.field&&(a.field=""))}))},d.prototype._createDomValue=function(){var a;return"array"==this.type?(a=document.createElement("div"),a.className="readonly",a.innerHTML="[...]"):"object"==this.type?(a=document.createElement("div"),a.className="readonly",a.innerHTML="{...}"):!this.editor.mode.edit&&util.isUrl(this.value)?(a=document.createElement("a"),a.className="value",a.href=this.value,a.target="_blank",a.innerHTML=this._escapeHTML(this.value)):(a=document.createElement("div"),a.contentEditable=!this.editor.mode.view,a.spellcheck=!1,a.className="value",a.innerHTML=this._escapeHTML(this.value)),a},d.prototype._createDomExpandButton=function(){var a=document.createElement("button");return this._hasChilds()?(a.className=this.expanded?"expanded":"collapsed",a.title="点击展开/折叠 (Ctrl+E) \n按住Ctrl点击展开/折叠所有子节点"):(a.className="invisible",a.title=""),a},d.prototype._createDomTree=function(){var a,b,c,d,e,f=this.dom,g=document.createElement("table"),h=document.createElement("tbody");return g.style.borderCollapse="collapse",g.className="values",g.appendChild(h),a=document.createElement("tr"),h.appendChild(a),b=document.createElement("td"),b.className="tree",a.appendChild(b),f.expand=this._createDomExpandButton(),b.appendChild(f.expand),f.tdExpand=b,c=document.createElement("td"),c.className="tree",a.appendChild(c),f.field=this._createDomField(),c.appendChild(f.field),f.tdField=c,d=document.createElement("td"),d.className="tree",a.appendChild(d),"object"!=this.type&&"array"!=this.type&&(d.appendChild(document.createTextNode(":")),d.className="separator"),f.tdSeparator=d,e=document.createElement("td"),e.className="tree",a.appendChild(e),f.value=this._createDomValue(),e.appendChild(f.value),f.tdValue=e,g},d.prototype.onEvent=function(a){var b,c,d,e,f,g,h,i=a.type,j=a.target||a.srcElement,k=this.dom,l=this,m=this._hasChilds();if((j==k.drag||j==k.menu)&&("mouseover"==i?this.editor.highlighter.highlight(this):"mouseout"==i&&this.editor.highlighter.unhighlight()),"mousedown"==i&&j==k.drag&&this._onDragStart(a),"click"==i&&j==k.menu&&(c=l.editor.highlighter,c.highlight(l),c.lock(),util.addClassName(k.menu,"selected"),this.showContextMenu(k.menu,function(){util.removeClassName(k.menu,"selected"),c.unlock(),c.unhighlight()})),"click"==i&&j==k.expand&&m&&(d=a.ctrlKey,this._onExpand(d)),e=k.value,j==e)switch(i){case"focus":b=this;break;case"blur":case"change":this._getDomValue(!0),this._updateDomValue(),this.value&&(e.innerHTML=this._escapeHTML(this.value));break;case"input":this._getDomValue(!0),this._updateDomValue();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getSelection();break;case"click":a.ctrlKey&&this.editor.mode.edit&&util.isUrl(this.value)&&window.open(this.value,"_blank");break;case"keyup":this._getDomValue(!0),this._updateDomValue();break;case"cut":case"paste":setTimeout(function(){l._getDomValue(!0),l._updateDomValue()},1)}if(f=k.field,j==f)switch(i){case"focus":b=this;break;case"blur":case"change":this._getDomField(!0),this._updateDomField(),this.field&&(f.innerHTML=this._escapeHTML(this.field));break;case"input":this._getDomField(!0),this._updateDomField();break;case"keydown":case"mousedown":this.editor.selection=this.editor.getSelection();break;case"keyup":this._getDomField(!0),this._updateDomField();break;case"cut":case"paste":setTimeout(function(){l._getDomField(!0),l._updateDomField()},1)}if(g=k.tree,j==g.parentNode)switch(i){case"click":h=void 0!=a.offsetX?a.offsetX<24*(this.getLevel()+1):a.pageX<util.getAbsoluteLeft(k.tdSeparator),h||m?f&&(util.setEndOfContentEditable(f),f.focus()):e&&(util.setEndOfContentEditable(e),e.focus())}if(j==k.tdExpand&&!m||j==k.tdField||j==k.tdSeparator)switch(i){case"click":f&&(util.setEndOfContentEditable(f),f.focus())}"keydown"==i&&this.onKeyDown(a)},d.prototype.onKeyDown=function(a){var b,c,f,g,h,i,j,k,l,m,n,o,p,q,r=a.which||a.keyCode,s=a.target||a.srcElement,t=a.ctrlKey,u=a.shiftKey,v=a.altKey,w=!1;13==r?s==this.dom.value?(!this.editor.mode.edit||a.ctrlKey)&&util.isUrl(this.value)&&(window.open(this.value,"_blank"),w=!0):s==this.dom.expand&&(h=this._hasChilds(),h&&(i=a.ctrlKey,this._onExpand(i),s.focus(),w=!0)):68==r?t&&(this._onDuplicate(),w=!0):69==r?t&&(this._onExpand(u),s.focus(),w=!0):77==r?t&&(this.showContextMenu(s),w=!0):46==r?t&&(this._onRemove(),w=!0):45==r?t&&!u?(this._onInsertBefore(),w=!0):t&&u&&(this._onInsertAfter(),w=!0):35==r?v&&(j=this._lastNode(),j&&j.focus(d.focusElement||this._getElementName(s)),w=!0):36==r?v&&(k=this._firstNode(),k&&k.focus(d.focusElement||this._getElementName(s)),w=!0):37==r?v&&!u?(l=this._previousElement(s),l&&this.focus(this._getElementName(l)),w=!0):v&&u&&(this.expanded?(m=this.getAppend(),f=m?m.nextSibling:void 0):(n=this.getDom(),f=n.nextSibling),f&&(c=d.getNodeFromTarget(f),g=f.nextSibling,q=d.getNodeFromTarget(g),c&&c instanceof e&&1!=this.parent.childs.length&&q&&q.parent&&(q.parent.moveBefore(this,q),this.focus(d.focusElement||this._getElementName(s))))):38==r?v&&!u?(b=this._previousNode(),b&&b.focus(d.focusElement||this._getElementName(s)),w=!0):v&&u&&(b=this._previousNode(),b&&b.parent&&(b.parent.moveBefore(this,b),this.focus(d.focusElement||this._getElementName(s))),w=!0):39==r?v&&!u?(o=this._nextElement(s),o&&this.focus(this._getElementName(o)),w=!0):v&&u&&(n=this.getDom(),p=n.previousSibling,p&&(b=d.getNodeFromTarget(p),b&&b.parent&&b instanceof e&&!b.isVisible()&&(b.parent.moveBefore(this,b),this.focus(d.focusElement||this._getElementName(s))))):40==r&&(v&&!u?(c=this._nextNode(),c&&c.focus(d.focusElement||this._getElementName(s)),w=!0):v&&u&&(c=this.expanded?this.append?this.append._nextNode():void 0:this._nextNode(),f=c?c.getDom():void 0,g=1==this.parent.childs.length?f:f?f.nextSibling:void 0,q=d.getNodeFromTarget(g),q&&q.parent&&(q.parent.moveBefore(this,q),this.focus(d.focusElement||this._getElementName(s))),w=!0)),w&&(a.preventDefault(),a.stopPropagation())},d.prototype._onExpand=function(a){if(a){var b=this.dom.tr.parentNode,c=b.parentNode,d=c.scrollTop;c.removeChild(b)}this.expanded?this.collapse(a):this.expand(a),a&&(c.appendChild(b),c.scrollTop=d)},d.prototype._onRemove=function(){var a,b,c,d;this.editor.highlighter.unhighlight(),a=this.parent.childs,b=a.indexOf(this),c=this.editor.getSelection(),a[b+1]?a[b+1].focus():a[b-1]?a[b-1].focus():this.parent.focus(),d=this.editor.getSelection(),this.parent._remove(this),this.editor._onAction("removeNode",{node:this,parent:this.parent,index:b,oldSelection:c,newSelection:d})},d.prototype._onDuplicate=function(){var a,b=this.editor.getSelection(),c=this.parent._duplicate(this);c.focus(),a=this.editor.getSelection(),this.editor._onAction("duplicateNode",{node:this,clone:c,parent:this.parent,oldSelection:b,newSelection:a})},d.prototype._onInsertBefore=function(a,b,c){var e,f=this.editor.getSelection(),g=new d(this.editor,{field:void 0!=a?a:"",value:void 0!=b?b:"",type:c});g.expand(!0),this.parent.insertBefore(g,this),this.editor.highlighter.unhighlight(),g.focus("field"),e=this.editor.getSelection(),this.editor._onAction("insertBeforeNode",{node:g,beforeNode:this,parent:this.parent,oldSelection:f,newSelection:e})},d.prototype._onInsertAfter=function(a,b,c){var e,f=this.editor.getSelection(),g=new d(this.editor,{field:void 0!=a?a:"",value:void 0!=b?b:"",type:c});g.expand(!0),this.parent.insertAfter(g,this),this.editor.highlighter.unhighlight(),g.focus("field"),e=this.editor.getSelection(),this.editor._onAction("insertAfterNode",{node:g,afterNode:this,parent:this.parent,oldSelection:f,newSelection:e})},d.prototype._onAppend=function(a,b,c){var e,f=this.editor.getSelection(),g=new d(this.editor,{field:void 0!=a?a:"",value:void 0!=b?b:"",type:c});g.expand(!0),this.parent.appendChild(g),this.editor.highlighter.unhighlight(),g.focus("field"),e=this.editor.getSelection(),this.editor._onAction("appendNode",{node:g,parent:this.parent,oldSelection:f,newSelection:e})},d.prototype._onChangeType=function(a){var b,c,d=this.type;a!=d&&(b=this.editor.getSelection(),this.changeType(a),c=this.editor.getSelection(),this.editor._onAction("changeType",{node:this,oldType:d,newType:a,oldSelection:b,newSelection:c}))},d.prototype._onSort=function(a){var b,c,d,e;this._hasChilds()&&(b="desc"==a?-1:1,c="array"==this.type?"value":"field",this.hideChilds(),d=this.childs,e=this.sort,this.childs=this.childs.concat(),this.childs.sort(function(a,d){return a[c]>d[c]?b:a[c]<d[c]?-b:0}),this.sort=1==b?"asc":"desc",this.editor._onAction("sort",{node:this,oldChilds:d,oldSort:e,newChilds:this.childs,newSort:this.sort}),this.showChilds())},d.prototype.getAppend=function(){return this.append||(this.append=new e(this.editor),this.append.setParent(this)),this.append.getDom()},d.getNodeFromTarget=function(a){for(;a;){if(a.node)return a.node;a=a.parentNode}return void 0},d.prototype._previousNode=function(){var a,b=null,c=this.getDom();if(c&&c.parentNode){a=c;do a=a.previousSibling,b=d.getNodeFromTarget(a);while(a&&b instanceof e&&!b.isVisible())}return b},d.prototype._nextNode=function(){var a,b=null,c=this.getDom();if(c&&c.parentNode){a=c;do a=a.nextSibling,b=d.getNodeFromTarget(a);while(a&&b instanceof e&&!b.isVisible())}return b},d.prototype._firstNode=function(){var a,b=null,c=this.getDom();return c&&c.parentNode&&(a=c.parentNode.firstChild,b=d.getNodeFromTarget(a)),b},d.prototype._lastNode=function(){var a,b=null,c=this.getDom();if(c&&c.parentNode)for(a=c.parentNode.lastChild,b=d.getNodeFromTarget(a);a&&b instanceof e&&!b.isVisible();)a=a.previousSibling,b=d.getNodeFromTarget(a);return b},d.prototype._previousElement=function(a){var b=this.dom;switch(a){case b.value:if(this.fieldEditable)return b.field;case b.field:if(this._hasChilds())return b.expand;case b.expand:return b.menu;case b.menu:if(b.drag)return b.drag;default:return null}},d.prototype._nextElement=function(a){var b=this.dom;switch(a){case b.drag:return b.menu;case b.menu:if(this._hasChilds())return b.expand;case b.expand:if(this.fieldEditable)return b.field;case b.field:if(!this._hasChilds())return b.value;default:return null}},d.prototype._getElementName=function(a){var b,c=this.dom;for(b in c)if(c.hasOwnProperty(b)&&c[b]==a)return b;return null},d.prototype._hasChilds=function(){return"array"==this.type||"object"==this.type},d.TYPE_TITLES={auto:"自动识别",object:"object对象",array:"array数组",string:"string字符串"},d.prototype.showContextMenu=function(a,b){var c,e,g,h=this,i=d.TYPE_TITLES,j=[];j.push({text:"类型",title:"改变类型",className:"type-"+this.type,submenu:[{text:"Auto",className:"type-auto"+("auto"==this.type?" selected":""),title:i.auto,click:function(){h._onChangeType("auto")}},{text:"Array",className:"type-array"+("array"==this.type?" selected":""),title:i.array,click:function(){h._onChangeType("array")}},{text:"Object",className:"type-object"+("object"==this.type?" selected":""),title:i.object,click:function(){h._onChangeType("object")}},{text:"String",className:"type-string"+("string"==this.type?" selected":""),title:i.string,click:function(){h._onChangeType("string")}}]}),this._hasChilds()&&(c="asc"==this.sort?"desc":"asc",j.push({text:"排序",title:"Sort the childs of this "+this.type,className:"sort-"+c,click:function(){h._onSort(c)},submenu:[{text:"Asc升序",className:"sort-asc",title:"Sort the childs of this "+this.type+" in ascending order",click:function(){h._onSort("asc")}},{text:"Desc降序",className:"sort-desc",title:"Sort the childs of this "+this.type+" in descending order",click:function(){h._onSort("desc")}}]})),this.parent&&this.parent._hasChilds()&&(j.push({type:"separator"}),e=h.parent.childs,h==e[e.length-1]&&j.push({text:"添加",title:"快捷添加 (Ctrl+Shift+Ins)",submenuTitle:"Select the type of the field to be appended",className:"append",click:function(){h._onAppend("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:i.auto,click:function(){h._onAppend("","","auto")}},{text:"Array",className:"type-array",title:i.array,click:function(){h._onAppend("",[])}},{text:"Object",className:"type-object",title:i.object,click:function(){h._onAppend("",{})}},{text:"String",className:"type-string",title:i.string,click:function(){h._onAppend("","","string")}}]}),j.push({text:"插入",title:"快捷插入 (Ctrl+Ins)",submenuTitle:"选择要插入的字段的类型",className:"insert",click:function(){h._onInsertBefore("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:i.auto,click:function(){h._onInsertBefore("","","auto")}},{text:"Array",className:"type-array",title:i.array,click:function(){h._onInsertBefore("",[])}},{text:"Object",className:"type-object",title:i.object,click:function(){h._onInsertBefore("",{})}},{text:"String",className:"type-string",title:i.string,click:function(){h._onInsertBefore("","","string")}}]}),j.push({text:"复制",title:"快捷复制 (Ctrl+D)",className:"duplicate",click:function(){h._onDuplicate()}}),j.push({text:"删除",title:"快捷删除 (Ctrl+Del)",className:"remove",click:function(){h._onRemove()}})),g=new f(j,{close:b}),g.show(a)},d.prototype._getType=function(a){return a instanceof Array?"array":a instanceof Object?"object":"string"==typeof a&&"string"!=typeof this._stringCast(a)?"string":"auto"},d.prototype._stringCast=function(a){var b=a.toLowerCase(),c=Number(a),d=parseFloat(a);return""==a?"":"null"==b?null:"true"==b?!0:"false"==b?!1:isNaN(c)||isNaN(d)?a:c},d.prototype._escapeHTML=function(a){var b=String(a).replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/  /g," &nbsp;").replace(/^ /,"&nbsp;").replace(/ $/,"&nbsp;"),c=JSON.stringify(b);return c.substring(1,c.length-1)},d.prototype._unescapeHTML=function(a){var b='"'+this._escapeJSON(a)+'"',c=util.parse(b);return c.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;|\u00A0/g," ")},d.prototype._escapeJSON=function(a){var b,c,d,e;for(b="",c=0,d=a.length;d>c;)e=a.charAt(c),"\n"==e?b+="\\n":"\\"==e?(b+=e,c++,e=a.charAt(c),-1=='"\\/bfnrtu'.indexOf(e)&&(b+="\\"),b+=e):b+='"'==e?'\\"':e,c++;return b},e.prototype=new d,e.prototype.getDom=function(){var a,b,c,d,e,f=this.dom;return f.tr?f.tr:(a=document.createElement("tr"),a.node=this,f.tr=a,this.editor.mode.edit&&(f.tdDrag=document.createElement("td"),b=document.createElement("td"),f.tdMenu=b,c=document.createElement("button"),c.className="contextmenu",c.title="Click to open the actions menu (Ctrl+M)",f.menu=c,b.appendChild(f.menu)),d=document.createElement("td"),e=document.createElement("div"),e.innerHTML="(empty)",e.className="readonly",d.appendChild(e),f.td=d,f.text=e,this.updateDom(),a)},e.prototype.updateDom=function(){var a,b,c=this.dom,d=c.td;d&&(d.style.paddingLeft=24*this.getLevel()+26+"px"),a=c.text,a&&(a.innerHTML="(empty "+this.parent.type+")"),b=c.tr,this.isVisible()?c.tr.firstChild||(c.tdDrag&&b.appendChild(c.tdDrag),c.tdMenu&&b.appendChild(c.tdMenu),b.appendChild(d)):c.tr.firstChild&&(c.tdDrag&&b.removeChild(c.tdDrag),c.tdMenu&&b.removeChild(c.tdMenu),b.removeChild(d))},e.prototype.isVisible=function(){return 0==this.parent.childs.length},e.prototype.showContextMenu=function(a,b){var c=this,e=d.TYPE_TITLES,g=[{text:"添加对象",title:"快捷添加 (Ctrl+Shift+Ins)",submenuTitle:"Select the type of the field to be appended",className:"insert",click:function(){c._onAppend("","","auto")},submenu:[{text:"Auto",className:"type-auto",title:e.auto,click:function(){c._onAppend("","","auto")}},{text:"Array",className:"type-array",title:e.array,click:function(){c._onAppend("",[])}},{text:"Object",className:"type-object",title:e.object,click:function(){c._onAppend("",{})}},{text:"String",className:"type-string",title:e.string,click:function(){c._onAppend("","","string")}}]}],h=new f(g,{close:b});h.show(a)},e.prototype.onEvent=function(a){var b,c=a.type,d=a.target||a.srcElement,e=this.dom,f=e.menu;d==f&&("mouseover"==c?this.editor.highlighter.highlight(this.parent):"mouseout"==c&&this.editor.highlighter.unhighlight()),"click"==c&&d==e.menu&&(b=this.editor.highlighter,b.highlight(this.parent),b.lock(),util.addClassName(e.menu,"selected"),this.showContextMenu(e.menu,function(){util.removeClassName(e.menu,"selected"),b.unlock(),b.unhighlight()})),"keydown"==c&&this.onKeyDown(a)},f.prototype._getVisibleButtons=function(){var a=[],b=this;return this.dom.items.forEach(function(c){a.push(c.button),c.buttonExpand&&a.push(c.buttonExpand),c.subItems&&c==b.expandedItem&&c.subItems.forEach(function(b){a.push(b.button),b.buttonExpand&&a.push(b.buttonExpand)})}),a},f.visibleMenu=void 0,f.prototype.show=function(a){var b,c,d,e,g,h,i,j,k;this.hide(),b=window.innerHeight,c=window.pageYOffset||document.scrollTop||0,d=b+c,e=a.offsetHeight,g=this.maxHeight,h=util.getAbsoluteLeft(a),i=util.getAbsoluteTop(a),d>i+e+g?(this.dom.menu.style.left=h+"px",this.dom.menu.style.top=i+e+"px",this.dom.menu.style.bottom=""):(this.dom.menu.style.left=h+"px",this.dom.menu.style.top="",this.dom.menu.style.bottom=b-i+"px"),document.body.appendChild(this.dom.menu),j=this,k=this.dom.list,this.eventListeners.mousedown=util.addEventListener(document,"mousedown",function(a){var b=a.target;b==k||j._isChildOf(b,k)||(j.hide(),a.stopPropagation(),a.preventDefault())}),this.eventListeners.mousewheel=util.addEventListener(document,"mousewheel",function(a){a.stopPropagation(),a.preventDefault()}),this.eventListeners.keydown=util.addEventListener(document,"keydown",function(a){j._onKeyDown(a)}),this.selection=util.getSelection(),this.anchor=a,setTimeout(function(){j.dom.focusButton.focus()},0),f.visibleMenu&&f.visibleMenu.hide(),f.visibleMenu=this},f.prototype.hide=function(){var a,b;this.dom.menu.parentNode&&(this.dom.menu.parentNode.removeChild(this.dom.menu),this.onClose&&this.onClose());for(a in this.eventListeners)this.eventListeners.hasOwnProperty(a)&&(b=this.eventListeners[a],b&&util.removeEventListener(document,a,b),delete this.eventListeners[a]);f.visibleMenu==this&&(f.visibleMenu=void 0)},f.prototype._onExpandItem=function(a){var b,c=this,d=a==this.expandedItem,e=this.expandedItem;e&&(e.ul.style.height="0",e.ul.style.padding="",setTimeout(function(){c.expandedItem!=e&&(e.ul.style.display="",util.removeClassName(e.ul.parentNode,"selected"))},300),this.expandedItem=void 0),d||(b=a.ul,b.style.display="block",b.clientHeight,setTimeout(function(){c.expandedItem==a&&(b.style.height=24*b.childNodes.length+"px",b.style.padding="5px 10px")},0),util.addClassName(b.parentNode,"selected"),this.expandedItem=a)},f.prototype._onKeyDown=function(a){var b,c,d,e,f=a.target,g=a.which,h=!1;27==g?(this.selection&&util.setSelection(this.selection),this.anchor&&this.anchor.focus(),this.hide(),h=!0):9==g?a.shiftKey?(b=this._getVisibleButtons(),c=b.indexOf(f),0==c&&(b[b.length-1].focus(),h=!0)):(b=this._getVisibleButtons(),c=b.indexOf(f),c==b.length-1&&(b[0].focus(),h=!0)):37==g?("expand"==f.className&&(b=this._getVisibleButtons(),c=b.indexOf(f),d=b[c-1],d&&d.focus()),h=!0):38==g?(b=this._getVisibleButtons(),c=b.indexOf(f),d=b[c-1],d&&"expand"==d.className&&(d=b[c-2]),d||(d=b[b.length-1]),d&&d.focus(),h=!0):39==g?(b=this._getVisibleButtons(),c=b.indexOf(f),e=b[c+1],e&&"expand"==e.className&&e.focus(),h=!0):40==g&&(b=this._getVisibleButtons(),c=b.indexOf(f),e=b[c+1],e&&"expand"==e.className&&(e=b[c+2]),e||(e=b[0]),e&&(e.focus(),h=!0),h=!0),h&&(a.stopPropagation(),a.preventDefault())},f.prototype._isChildOf=function(a,b){for(var c=a.parentNode;c;){if(c==b)return!0;c=c.parentNode}return!1},g.prototype.onChange=function(){},g.prototype.add=function(a,b){this.index++,this.history[this.index]={action:a,params:b,timestamp:new Date},this.index<this.history.length-1&&this.history.splice(this.index+1,this.history.length-this.index-1),this.onChange()},g.prototype.clear=function(){this.history=[],this.index=-1,this.onChange()},g.prototype.canUndo=function(){return this.index>=0},g.prototype.canRedo=function(){return this.index<this.history.length-1},g.prototype.undo=function(){var a,b;this.canUndo()&&(a=this.history[this.index],a&&(b=this.actions[a.action],b&&b.undo?(b.undo(a.params),a.params.oldSelection&&this.editor.setSelection(a.params.oldSelection)):util.log('Error: unknown action "'+a.action+'"')),this.index--,this.onChange())},g.prototype.redo=function(){var a,b;this.canRedo()&&(this.index++,a=this.history[this.index],a&&(b=this.actions[a.action],b&&b.redo?(b.redo(a.params),a.params.newSelection&&this.editor.setSelection(a.params.newSelection)):util.log('Error: unknown action "'+a.action+'"')),this.onChange())},i.prototype.next=function(a){if(void 0!=this.results){var b=void 0!=this.resultIndex?this.resultIndex+1:0;b>this.results.length-1&&(b=0),this._setActiveResult(b,a)}},i.prototype.previous=function(a){if(void 0!=this.results){var b=this.results.length-1,c=void 0!=this.resultIndex?this.resultIndex-1:b;0>c&&(c=b),this._setActiveResult(c,a)}},i.prototype._setActiveResult=function(a,b){var c,d,e,f;return this.activeResult&&(c=this.activeResult.node,d=this.activeResult.elem,"field"==d?delete c.searchFieldActive:delete c.searchValueActive,c.updateDom()),this.results&&this.results[a]?(this.resultIndex=a,e=this.results[this.resultIndex].node,f=this.results[this.resultIndex].elem,"field"==f?e.searchFieldActive=!0:e.searchValueActive=!0,this.activeResult=this.results[this.resultIndex],e.updateDom(),e.scrollTo(function(){b&&e.focus(f)}),void 0):(this.resultIndex=void 0,this.activeResult=void 0,void 0)},i.prototype._clearDelay=function(){void 0!=this.timeout&&(clearTimeout(this.timeout),delete this.timeout)},i.prototype._onDelayedSearch=function(){this._clearDelay();var a=this;this.timeout=setTimeout(function(b){a._onSearch(b)},this.delay)},i.prototype._onSearch=function(a,b){var c,d,e;if(this._clearDelay(),c=this.dom.search.value,d=c.length>0?c:void 0,d!=this.lastText||b)if(this.lastText=d,this.results=this.editor.search(d),this._setActiveResult(void 0),void 0!=d)switch(e=this.results.length){case 0:this.dom.results.innerHTML="没有找到";break;case 1:this.dom.results.innerHTML="1 个结果";break;default:this.dom.results.innerHTML=e+"&nbsp;个结果"}else this.dom.results.innerHTML=""},i.prototype._onKeyDown=function(a){var b=a.which;27==b?(this.dom.search.value="",this._onSearch(a),a.preventDefault(),a.stopPropagation()):13==b&&(a.ctrlKey?this._onSearch(a,!0):a.shiftKey?this.previous():this.next(),a.preventDefault(),a.stopPropagation())},i.prototype._onKeyUp=function(a){var b=a.keyCode;27!=b&&13!=b&&this._onDelayedSearch(a)},j.prototype.highlight=function(a){this.locked||(this.node!=a&&(this.node&&this.node.setHighlight(!1),this.node=a,this.node.setHighlight(!0)),this._cancelUnhighlight())},j.prototype.unhighlight=function(){if(!this.locked){var a=this;this.node&&(this._cancelUnhighlight(),this.unhighlightTimer=setTimeout(function(){a.node.setHighlight(!1),a.node=void 0,a.unhighlightTimer=void 0},0))}},j.prototype._cancelUnhighlight=function(){this.unhighlightTimer&&(clearTimeout(this.unhighlightTimer),this.unhighlightTimer=void 0)},j.prototype.lock=function(){this.locked=!0},j.prototype.unlock=function(){this.locked=!1},util={},util.parse=function(a){try{return JSON.parse(a)}catch(b){throw util.validate(a),b}},util.validate=function(a){"undefined"!=typeof jsonlint?jsonlint.parse(a):JSON.parse(a)},util.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},util.clear=function(a){for(var b in a)a.hasOwnProperty(b)&&delete a[b];return a},util.log=function(){"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)},util.type=function(a){return null===a?"null":void 0===a?"undefined":a instanceof Number||"number"==typeof a?"number":a instanceof String||"string"==typeof a?"string":a instanceof Boolean||"boolean"==typeof a?"boolean":a instanceof RegExp||"regexp"==typeof a?"regexp":Array.isArray(a)?"array":"object"},k=/^https?:\/\/\S+$/,util.isUrl=function(a){return("string"==typeof a||a instanceof String)&&k.test(a)},util.getAbsoluteLeft=function(a){var b=a.getBoundingClientRect();return b.left+window.pageXOffset||document.scrollLeft||0},util.getAbsoluteTop=function(a){var b=a.getBoundingClientRect();return b.top+window.pageYOffset||document.scrollTop||0},util.addClassName=function(a,b){var c=a.className.split(" ");-1==c.indexOf(b)&&(c.push(b),a.className=c.join(" "))},util.removeClassName=function(a,b){var c=a.className.split(" "),d=c.indexOf(b);-1!=d&&(c.splice(d,1),a.className=c.join(" "))},util.stripFormatting=function(a){var b,c,d,e,f,g,h;for(b=a.childNodes,c=0,d=b.length;d>c;c++){if(e=b[c],e.style&&e.removeAttribute("style"),f=e.attributes)for(g=f.length-1;g>=0;g--)h=f[g],1==h.specified&&e.removeAttribute(h.name);util.stripFormatting(e)}},util.setEndOfContentEditable=function(a){var b,c;document.createRange&&(b=document.createRange(),b.selectNodeContents(a),b.collapse(!1),c=window.getSelection(),c.removeAllRanges(),c.addRange(b))},util.selectContentEditable=function(a){if(a&&"DIV"==a.nodeName){var b,c;window.getSelection&&document.createRange&&(c=document.createRange(),c.selectNodeContents(a),b=window.getSelection(),b.removeAllRanges(),b.addRange(c))}},util.getSelection=function(){if(window.getSelection){var a=window.getSelection();if(a.getRangeAt&&a.rangeCount)return a.getRangeAt(0)}return null},util.setSelection=function(a){if(a&&window.getSelection){var b=window.getSelection();b.removeAllRanges(),b.addRange(a)}},util.getSelectionOffset=function(){var a=util.getSelection();return a&&"startOffset"in a&&"endOffset"in a&&a.startContainer&&a.startContainer==a.endContainer?{startOffset:a.startOffset,endOffset:a.endOffset,container:a.startContainer.parentNode}:null},util.setSelectionOffset=function(a){var b,c;document.createRange&&window.getSelection&&(b=window.getSelection(),b&&(c=document.createRange(),c.setStart(a.container.firstChild,a.startOffset),c.setEnd(a.container.firstChild,a.endOffset),util.setSelection(c)))},util.getInnerText=function(a,b){var c,d,e,f,g,h,i,j=void 0==b;if(j&&(b={text:"",flush:function(){var a=this.text;return this.text="",a},set:function(a){this.text=a}}),a.nodeValue)return b.flush()+a.nodeValue;if(a.hasChildNodes()){for(c=a.childNodes,d="",e=0,f=c.length;f>e;e++)g=c[e],"DIV"==g.nodeName||"P"==g.nodeName?(h=c[e-1],i=h?h.nodeName:void 0,i&&"DIV"!=i&&"P"!=i&&"BR"!=i&&(d+="\n",b.flush()),d+=util.getInnerText(g,b),b.set("\n")):"BR"==g.nodeName?(d+=b.flush(),b.set("\n")):d+=util.getInnerText(g,b);return d}return"P"==a.nodeName&&-1!=util.getInternetExplorerVersion()?b.flush():""},util.getInternetExplorerVersion=function(){var a,b,c;return-1==l&&(a=-1,"Microsoft Internet Explorer"==navigator.appName&&(b=navigator.userAgent,c=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),null!=c.exec(b)&&(a=parseFloat(RegExp.$1))),l=a),l},util.isFirefox=function(){return-1!=navigator.userAgent.indexOf("Firefox")},l=-1,util.addEventListener=function(a,b,c,d){if(a.addEventListener)return void 0===d&&(d=!1),"mousewheel"===b&&util.isFirefox()&&(b="DOMMouseScroll"),a.addEventListener(b,c,d),c;if(a.attachEvent){var e=function(){return c.call(a,window.event)};return a.attachEvent("on"+b,e),e}},util.removeEventListener=function(a,b,c,d){a.removeEventListener?(void 0===d&&(d=!1),"mousewheel"===b&&util.isFirefox()&&(b="DOMMouseScroll"),a.removeEventListener(b,c,d)):a.detachEvent&&a.detachEvent("on"+b,c)},m={JSONEditor:a,JSONFormatter:function(){throw new Error('JSONFormatter is deprecated. Use JSONEditor with mode "text" or "code" instead')},util:util},n=function(){var a,b,c,d,e,f;for(a=document.getElementsByTagName("script"),b=0;b<a.length;b++)if(c=a[b].src,/(^|\/)jsoneditor([-\.]min)?.js$/.test(c)){d=c.split("?")[0],e=d.substring(0,d.length-2)+"css",f=document.createElement("link"),f.type="text/css",f.rel="stylesheet",f.href=e,document.getElementsByTagName("head")[0].appendChild(f);break}},"undefined"!=typeof module&&"undefined"!=typeof exports&&(n(),module.exports=exports=m),"undefined"!=typeof require&&"undefined"!=typeof define?(n(),define(function(){return m})):window.jsoneditor=m}();